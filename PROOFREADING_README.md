# Proofreading Workflow

## Overview
Stories generated by `generate_story.py` are **NOT automatically published** to the website. They must first be proofread and approved using the `proofread_story.py` script.

## Workflow

### 1. Generate a Story
```powershell
cd generator
python generate_story.py --user-prompt prompts/my-story.txt
```

This creates the story files in `stories/<story-id>/` but does **NOT** add it to `stories/index.json`.

### 2. Proofread the Story
```powershell
python proofread_story.py <story-id>
```

The script will:
- Display the story metadata (title, author, description, date)
- Present each node in order (breadth-first traversal from "start")
- Show the full text and choices for each node
- Prompt you to **Accept** (y), **Reject** (n), or **Quit** (q)

### 3. Approval Process

For each node:
- **Press `y` or Enter** ‚Üí Accept the node (proofreading passed)
- **Press `n`** ‚Üí Reject the node (needs editing)
- **Press `q`** ‚Üí Quit proofreading (story not published)

### 4. Publication

If **all nodes are accepted**:
- You'll be prompted: "Publish story to index.json?"
- Press `y` or Enter to publish
- The story is added to `stories/index.json`
- The story will now appear on the website

If **any node is rejected**:
- The story is NOT published
- You'll see a list of rejected nodes
- Edit the rejected node files manually
- Re-run the proofreading script

### 5. Git Commit & Push
```powershell
git add .
git commit -m "Add new story: <story-title>"
git push
```

The story will appear on GitHub Pages after the push.

## Example Session

```
> python proofread_story.py amulets-guardian

üîç Loading story: amulets-guardian

üìö Title: The Amulet's Guardian
‚úçÔ∏è  Author: AI Generated (Example)
üìÖ Created: 2025-11-08
üìù Description: Join Luna the cat on a magical adventure...

‚úÖ Found 17 nodes to proofread

Press Enter to start proofreading...

================================================================================
üìñ NODE 1/17: start
================================================================================

Luna was a curious gray cat who lived in a cozy house...

üìç CHOICES:
  1. Follow the sparkles ‚Üí follow-sparkles
  2. Look in the garden ‚Üí garden

--------------------------------------------------------------------------------

‚úì Accept this node? [y]es / [n]o (reject) / [q]uit: y
‚úÖ Node accepted

[... continues for all nodes ...]

================================================================================
üìä PROOFREADING COMPLETE
================================================================================
‚úÖ Accepted: 17 nodes
‚ùå Rejected: 0 nodes

‚úÖ All nodes accepted!

üì¢ Publish story to index.json? [y]es / [n]o: y

üìù Added new story to index.json
‚úÖ Story published successfully!
üåê Story will appear on the website after git push

‚ú® Done! Story is now published.
```

## Editing Rejected Nodes

If you reject a node during proofreading:

1. Open the node file: `stories/<story-id>/nodes/<node-id>.txt`
2. Edit the text directly
3. Save the file
4. Re-run the proofreading script: `python proofread_story.py <story-id>`

## Re-Proofreading Published Stories

You can re-run the proofreading script on already-published stories:
- If all nodes are accepted, it will update the entry in `index.json`
- Useful for updating metadata or verifying changes

## Previewing Unpublished Stories

To preview a story before it's published to `index.json`:
1. Open `reader.html?story=<story-id>&node=start` in your browser
2. The story will load even if not in `index.json`
3. Only published stories appear on the index page

## Script Details

### Command
```powershell
python proofread_story.py <story-id>
```

### Options
No additional options. The script is interactive and prompts for all decisions.

### Exit Codes
- `0` - Success (all nodes approved and published)
- `1` - Failure (proofreading incomplete, rejected nodes, or user cancelled)

## Files Modified

### During Generation
- `stories/<story-id>/story.json` - Created
- `stories/<story-id>/nodes/*.txt` - Created
- `stories/<story-id>/images/*.png` - Created (if images enabled)

### During Proofreading
- `stories/index.json` - Updated (only if all nodes approved)

## Tips

1. **Batch Proofreading**: Generate multiple stories, then proofread them all in one session
2. **Preview First**: Use the direct URL to preview stories before formal proofreading
3. **Track Progress**: The script shows "NODE 5/17" so you know how far along you are
4. **Quick Accept**: Just press Enter to accept (default is 'yes')
5. **Archive Prompts**: Keep used prompts in `generator/prompts-archive/` for reference

## Troubleshooting

### "Story not found" Error
- Ensure the story-id matches the directory name in `stories/`
- Check that `story.json` exists in the story directory

### Missing Nodes
- The script traverses from "start" node
- If nodes are unreachable, they won't appear in proofreading
- Check `story.json` for broken choice links

### Publishing Fails
- Ensure you have write permissions to `stories/index.json`
- Check that the JSON syntax is valid

## Future Enhancements
- Track proofreading history (who proofread, when)
- Support for partial approval (draft mode)
- Automated spell-check integration
- Batch operations (proofread multiple stories)
